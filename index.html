<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script>
      var editor = {};
      editor.move = false;
      editor.mode = 'blue';
      editor.rewScale = 1;
      editor.nativeX = 0;
      editor.nativeY = 0;
      editor.nativeX2 = 0;
      editor.nativeY2 = 0;      
    
      $(document).ready(function() {
	  var input = document.getElementById('input');
	  $('input').change(handleFiles);
	  
	  $('#blue').click(function() {
	    editor.mode = 'blue';
	  });

	  $('#red').click(function() {
	    editor.mode = 'red';
	  });

	  $('#draw_canvas').mousedown(function(e) {
	    editor.move = !editor.move;
	    if(editor.mode == 'blue'){
	      editor.nativeX = e.pageX - this.offsetLeft;
	      editor.nativeY = e.pageY - this.offsetTop;
	    }
	    if(editor.mode == 'red'){
	      editor.nativeX2 = e.pageX - this.offsetLeft;
	      editor.nativeY2 = e.pageY - this.offsetTop;
	    }
	    redraw();
	    calcCoords();
	  });
	  $('#draw_canvas').mousemove(function(e){
	    if(editor.move && editor.mode == 'blue'){
	      editor.nativeX = e.pageX - this.offsetLeft;
	      editor.nativeY = e.pageY - this.offsetTop;
	    }
	    if(editor.move && editor.mode == 'red'){
	      editor.nativeX2 = e.pageX - this.offsetLeft;
	      editor.nativeY2 = e.pageY - this.offsetTop;
	    }
	    redraw();
	    calcCoords();
	  });
      });
      
      function calcCoords() {
	var val = '';
	console.log(editor.nativeX);
	console.log(editor.rewScale);	
	val += ' x: ' + (editor.nativeX * editor.rewScale);
	val += ' y: ' + (editor.nativeY * editor.rewScale);
	val += ' w: ' + ((editor.nativeX2 - editor.nativeX) * editor.rewScale);
	val += ' h: ' + ((editor.nativeY2 - editor.nativeY) * editor.rewScale);
	$('#text').val(val);
      }
      
      function redraw() {
	  var canvas = document.getElementById('draw_canvas');
	  var ctx = canvas.getContext('2d');	  
	  ctx.clearRect(0, 0, canvas.width, canvas.height);
	  
	  ctx.beginPath();
	  ctx.strokeStyle="#0000ff";
	  ctx.moveTo(editor.nativeX, 0);
	  ctx.lineTo(editor.nativeX, canvas.height);
	  ctx.stroke();
	  
	  ctx.beginPath();
	  ctx.strokeStyle="#0000ff";
	  ctx.moveTo(0, editor.nativeY);
	  ctx.lineTo(canvas.width, editor.nativeY);
	  ctx.stroke();
	  
	  ctx.beginPath();
	  ctx.strokeStyle="#ff0000";
	  ctx.moveTo(editor.nativeX2, 0);
	  ctx.lineTo(editor.nativeX2, canvas.height);
	  ctx.stroke();
	  
	  ctx.beginPath();
	  ctx.strokeStyle="#ff0000";
	  ctx.moveTo(0, editor.nativeY2);
	  ctx.lineTo(canvas.width, editor.nativeY2);
	  ctx.stroke();

      }
      
      function handleFiles(e) {
	  var ctx = document.getElementById('canvas').getContext('2d');
	  var img = new Image;
	  img.onload = function() {
	      scale = 360.0 / img.width;
	      editor.rewScale = img.width / 360.0;
	      ctx.drawImage(img, 0, 0, 360, img.height * scale);
	  }
	  img.src = URL.createObjectURL(e.target.files[0]);
      }
    </script>
  </head>
  <body>
    <div style="position: absolute; display: block; top: 0px; left: 0px; width: 360px; height: 640px;">
      <canvas width="360px" height="640px" id="canvas" style="position: absolute; display: block; top: 0px; left: 0px;"></canvas>
      <canvas width="360px" height="640px" id="draw_canvas" style="position: absolute; display: block; top: 0px; left: 0px;"></canvas>
    </div>
    <div style="position: absolute; display: block; top: 0px; left: 370px; width: 360px; height: 640px; border: 1px solid #ff0000;">
      <input type="file" id="input"/><br />
      <div style="width: 75px; height: 30px; margin-top: 10px; background: #0000ff;" id="blue"></div>
      <div style="width: 75px; height: 30px; margin-top: 10px; background: #ff0000;" id="red"></div><br/>
      <textarea style="width: 320px; height: 100px; margin-left: 20px;" id="text"></textarea>
    </div>
  </body>
</html>
